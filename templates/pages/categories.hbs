<div class="text-center mb-6 sm:mb-8">
    <h1 class="text-xl sm:text-2xl font-semibold text-primary mb-2">Browse by Category</h1>
    <p class="text-secondary text-sm sm:text-base">{{categories.length}} catalog drawers to explore</p>
</div>

<div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 sm:mb-8 gap-4">
    <div class="flex-1 w-full">
        <input type="text" id="searchInput" class="w-full px-3 py-2 border border-border rounded-lg bg-white shadow-card focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/10" placeholder="Search categories...">
    </div>
    <div class="w-full sm:w-auto">
        <select id="sortBy" class="w-full sm:w-auto px-3 py-2 border border-gray-200 rounded-lg bg-white cursor-pointer appearance-none bg-no-repeat bg-right pr-10 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-colors" style="background-image: url('data:image/svg+xml,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 fill=%27none%27 viewBox=%270 0 24 24%27 stroke-width=%272%27 stroke=%27%239ca3af%27%3e%3cpath stroke-linecap=%27round%27 stroke-linejoin=%27round%27 d=%27m19 9-7 7-7-7%27/%3e%3c/svg%3e'); background-size: 16px 16px; background-position: right 12px center;">
            <option value="count">Sort by Count</option>
            <option value="name">Sort by Name</option>
        </select>
    </div>
</div>

<div class="card-catalog">
    <div class="catalog-grid" id="categoriesGrid">
        {{#each categories}}
        <a href="categories/{{slug}}.html" class="catalog-drawer" data-category="{{name}}" data-count="{{count}}">
            <div class="drawer-face">
                <div class="drawer-label-holder">
                    <div class="drawer-label">{{name}}</div>
                </div>
                <div class="drawer-pull"></div>
            </div>
            <div class="drawer-count">{{count}} books</div>
        </a>
        {{/each}}
    </div>
</div>

<script>
// Categories page functionality
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const sortBy = document.getElementById('sortBy');
    const categoriesGrid = document.getElementById('categoriesGrid');

    function filterAndSortCategories() {
        const searchTerm = searchInput.value.toLowerCase();
        const sortValue = sortBy.value;
        const categoryItems = Array.from(document.querySelectorAll('[data-category]'));

        // Filter categories
        categoryItems.forEach(item => {
            const categoryName = item.querySelector('.drawer-label').textContent.toLowerCase();
            const shouldShow = categoryName.includes(searchTerm);
            item.style.display = shouldShow ? 'flex' : 'none';
        });

        // Sort categories
        const visibleItems = categoryItems.filter(item => item.style.display !== 'none');
        visibleItems.sort((a, b) => {
            let aValue, bValue;

            switch (sortValue) {
                case 'name':
                    aValue = a.querySelector('.drawer-label').textContent.toLowerCase();
                    bValue = b.querySelector('.drawer-label').textContent.toLowerCase();
                    break;
                case 'count':
                    aValue = parseInt(a.dataset.count);
                    bValue = parseInt(b.dataset.count);
                    if (aValue > bValue) return -1;
                    if (aValue < bValue) return 1;
                    return 0;
                default:
                    return 0;
            }

            if (sortValue === 'name') {
                if (aValue < bValue) return -1;
                if (aValue > bValue) return 1;
                return 0;
            }
        });

        visibleItems.forEach(item => categoriesGrid.appendChild(item));
    }

    if (searchInput) searchInput.addEventListener('input', filterAndSortCategories);
    if (sortBy) sortBy.addEventListener('change', filterAndSortCategories);
    filterAndSortCategories();
});
</script>
