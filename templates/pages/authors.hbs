<div class="text-center mb-6 sm:mb-8">
    <h1 class="text-xl sm:text-2xl font-semibold text-primary mb-2">Meet the Authors</h1>
    <p class="text-secondary text-sm sm:text-base">{{authors.length}} index cards in the file</p>
</div>

<div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 sm:mb-8 gap-4">
    <div class="flex-1 w-full">
        <input type="text" id="searchInput" class="w-full px-3 py-2 border border-border rounded-lg bg-white shadow-card focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/10" placeholder="Search authors...">
    </div>
    <div class="w-full sm:w-auto">
        <select id="sortBy" class="w-full sm:w-auto px-3 py-2 border border-gray-200 rounded-lg bg-white cursor-pointer appearance-none bg-no-repeat bg-right pr-10 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-colors" style="background-image: url('data:image/svg+xml,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 fill=%27none%27 viewBox=%270 0 24 24%27 stroke-width=%272%27 stroke=%27%239ca3af%27%3e%3cpath stroke-linecap=%27round%27 stroke-linejoin=%27round%27 d=%27m19 9-7 7-7-7%27/%3e%3c/svg%3e'); background-size: 16px 16px; background-position: right 12px center;">
            <option value="count">Sort by Count</option>
            <option value="name">Sort by Name</option>
        </select>
    </div>
</div>

<div class="index-card-box">
    <div class="index-card-grid" id="authorsGrid">
        {{#each authors}}
        <a href="authors/{{slug}}.html" class="index-card" data-author="{{name}}" data-count="{{count}}">
            <div class="index-card-tab"></div>
            <div class="index-card-content">
                <div class="index-card-header">
                    <span class="index-card-name">{{name}}</span>
                </div>
                <div class="index-card-rule"></div>
                <div class="index-card-details">
                    <span class="index-card-count">{{count}} {{#if (eq count 1)}}book{{else}}books{{/if}}</span>
                </div>
            </div>
        </a>
        {{/each}}
    </div>
</div>

<script>
// Authors page functionality
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const sortBy = document.getElementById('sortBy');
    const authorsGrid = document.getElementById('authorsGrid');

    function filterAndSortAuthors() {
        const searchTerm = searchInput.value.toLowerCase();
        const sortValue = sortBy.value;
        const authorItems = Array.from(document.querySelectorAll('[data-author]'));

        // Filter authors
        authorItems.forEach(item => {
            const authorName = item.querySelector('.index-card-name').textContent.toLowerCase();
            const shouldShow = authorName.includes(searchTerm);
            item.style.display = shouldShow ? 'flex' : 'none';
        });

        // Sort authors
        const visibleItems = authorItems.filter(item => item.style.display !== 'none');
        visibleItems.sort((a, b) => {
            let aValue, bValue;

            switch (sortValue) {
                case 'name':
                    const aName = a.querySelector('.index-card-name').textContent;
                    const bName = b.querySelector('.index-card-name').textContent;

                    const aParts = aName.split(' ');
                    const bParts = bName.split(' ');

                    const aLastName = aParts[aParts.length - 1] || '';
                    const bLastName = bParts[bParts.length - 1] || '';
                    const aFirstName = aParts[0] || '';
                    const bFirstName = bParts[0] || '';

                    if (aLastName < bLastName) return -1;
                    if (aLastName > bLastName) return 1;
                    if (aFirstName < bFirstName) return -1;
                    if (aFirstName > bFirstName) return 1;
                    return 0;
                case 'count':
                    aValue = parseInt(a.dataset.count);
                    bValue = parseInt(b.dataset.count);
                    if (aValue > bValue) return -1;
                    if (aValue < bValue) return 1;
                    return 0;
                default:
                    return 0;
            }
        });

        visibleItems.forEach(item => authorsGrid.appendChild(item));
    }

    if (searchInput) searchInput.addEventListener('input', filterAndSortAuthors);
    if (sortBy) sortBy.addEventListener('change', filterAndSortAuthors);
    filterAndSortAuthors();
});
</script>
